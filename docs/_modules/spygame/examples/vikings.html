
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>spygame.examples.vikings &#8212; spygame 0.1a8 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/spygame_sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1a8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">spygame 0.1a8 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../spygame.html" accesskey="U">spygame</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for spygame.examples.vikings</h1><div class="highlight"><pre>
<span></span><span class="c1"># --------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#  spygame - examples/lost_vikings</span>
<span class="c1">#</span>
<span class="c1"># Lost Vikings extension for spygame.</span>
<span class="c1"># This module contains classes like `Erik`, `Fireball`, etc.. that are</span>
<span class="c1"># needed to recreate Lost Viking spygame.Level objects.</span>
<span class="c1">#</span>
<span class="c1"># created: 2017/07/03 in PyCharm</span>
<span class="c1"># (c) 2017 Sven - ducandu GmbH</span>
<span class="c1">#</span>
<span class="c1"># --------------------------------------------------------------</span>


<span class="kn">import</span> <span class="nn">spygame</span> <span class="k">as</span> <span class="nn">spyg</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">math</span>


<div class="viewcode-block" id="KeyLock"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.KeyLock">[docs]</a><span class="k">class</span> <span class="nc">KeyLock</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">image_file</span><span class="o">=</span><span class="s2">&quot;images/generic.png&quot;</span><span class="p">,</span> <span class="n">image_section</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="c1"># make sure we get stored as items-that-we-are-touching-right-now inside some physics component (in order to unlock iff using key and touching )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;touch&quot;</span><span class="p">)</span>
        <span class="c1"># don&#39;t collide with anything</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mask</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">render_order</span> <span class="o">=</span> <span class="mi">10</span>

<div class="viewcode-block" id="KeyLock.unlocked"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.KeyLock.unlocked">[docs]</a>    <span class="k">def</span> <span class="nf">unlocked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        will execute once a Viking is touching this KeyLock and using the matching Key Item</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="Viking"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking">[docs]</a><span class="k">class</span> <span class="nc">Viking</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">AnimatedSprite</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    a generic Viking class</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">spritesheet</span><span class="p">,</span> <span class="n">animation_setup</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param int x: the start x position</span>
<span class="sd">        :param int y: the start y position</span>
<span class="sd">        :param spyg.SpriteSheet spritesheet: the SpriteSheet object (tsx file) to use for this Viking</span>
<span class="sd">        :param dict animation_setup: a dictionary to be passed to spyg.Animation.register_settings and</span>
<span class="sd">                stored under the SpriteSheet.name in the animations registry</span>
<span class="sd">        :param spyg.HumanPlayerBrain brain: a custom spyg.HumanPlayerBrain to use for this Viking</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">spritesheet</span><span class="p">,</span> <span class="n">animation_setup</span><span class="p">,</span> <span class="n">width_height</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;friendly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mask</span> <span class="o">|=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;default,one_way_platform,particle&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">life_points</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame_bend</span> <span class="o">=</span> <span class="mi">63</span>  <span class="c1"># the frame number in the SpriteSheet where the character just bends down to start climbing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame_start_climb</span> <span class="o">=</span> <span class="mi">64</span>  <span class="c1"># the frame number in the SpriteSheet where the character is between bending down and climbing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frames</span> <span class="o">=</span> <span class="p">[</span><span class="mi">65</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">68</span><span class="p">]</span>  <span class="c1"># the frame numbers in the SpriteSheet that describe the climbing movement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unhealthy_fall_speed</span> <span class="o">=</span> <span class="mi">420</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unhealthy_fall_speed_on_slopes</span> <span class="o">=</span> <span class="mi">450</span>  <span class="c1"># on slopes, vikings can fall a little harder without hurting themselves</span>

        <span class="c1"># add components to this Viking</span>
        <span class="c1"># loop time line:</span>
        <span class="c1"># - pre-tick: HumanPlayerBrain (needs animation comp to check e.g., which commands are paralyzed), Physics (movement + collision resolution)</span>
        <span class="c1"># - tick: chose animation to play</span>
        <span class="c1"># - post-tick: Animation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_event</span><span class="p">(</span><span class="s2">&quot;pre_brain&quot;</span><span class="p">,</span> <span class="s2">&quot;pre_physics&quot;</span><span class="p">,</span> <span class="s2">&quot;post_physics&quot;</span><span class="p">,</span> <span class="s2">&quot;collision&quot;</span><span class="p">,</span> <span class="s2">&quot;pre_animation&quot;</span><span class="p">,</span> <span class="s2">&quot;post_animation&quot;</span><span class="p">)</span>

        <span class="c1"># add our Components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">HumanPlayerBrain</span><span class="p">(</span><span class="s2">&quot;brain&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]))</span>  <span class="c1"># type: spyg.HumanPlayerBrain</span>

        <span class="n">phys</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">PlatformerPhysics</span><span class="p">(</span><span class="s2">&quot;physics&quot;</span><span class="p">)</span>
        <span class="n">phys</span><span class="o">.</span><span class="n">squeeze_speed</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">phys</span><span class="p">)</span>  <span class="c1"># type: spyg.PlatformerPhysics</span>

        <span class="c1"># subscribe/register to some events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;bump.bottom&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;land&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;squeezed.top&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_squeezed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;hit.liquid_ground&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;hit_liquid_ground&quot;</span><span class="p">)</span>  <span class="c1"># player stepped into liquid ground</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;hit.particle&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;hit_particle&quot;</span><span class="p">)</span>  <span class="c1"># player hits a particle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;die&quot;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># some animations trigger &#39;die&#39; when done</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_event</span><span class="p">(</span><span class="s2">&quot;dead&quot;</span><span class="p">)</span>

        <span class="c1"># initialize the &#39;getting bored&#39;-timer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standing_around_since</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_bored_seq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span>  <span class="c1"># play the next &#39;bored&#39;-sequence after this amount of seconds</span>

    <span class="c1"># makes this Viking the currently active player</span>
<div class="viewcode-block" id="Viking.activate"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span></div>

    <span class="c1"># makes this Viking currently inactive</span>
<div class="viewcode-block" id="Viking.deactivate"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.deactivate">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">deactivate</span><span class="p">()</span></div>

    <span class="c1"># sequence of this Sprite&#39;s tick-flow:</span>
    <span class="c1"># - tick gets called by the Stage</span>
    <span class="c1"># - pre_brain is triggered</span>
    <span class="c1"># - HumanPlayerBrain is ticked</span>
    <span class="c1"># - pre_physics is triggered</span>
    <span class="c1"># - PlatformerPhysocs is ticked</span>
    <span class="c1"># -- determines x/y speeds and moves according to s = v*dt</span>
    <span class="c1"># -- runs collision detection against all layers</span>
    <span class="c1"># -- event &quot;collision&quot; is triggered on this Sprite if collisions are found</span>
    <span class="c1"># --- Physics Component listens for this event and handles the collision by solving for wall-bumps and slopes</span>
    <span class="c1"># - post_physics is triggered</span>
    <span class="c1"># - next animation to play is determined (play_animation is called)</span>
    <span class="c1"># - pre_animation is triggered</span>
    <span class="c1"># - Animation is ticked (now, the played animation will actually be blitted)</span>
    <span class="c1"># - post_animation is triggered</span>
<div class="viewcode-block" id="Viking.tick"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.tick">[docs]</a>    <span class="k">def</span> <span class="nf">tick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_loop</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">game_loop</span><span class="o">.</span><span class="n">dt</span>

        <span class="c1"># pre-brain event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="s2">&quot;pre_brain&quot;</span><span class="p">,</span> <span class="n">game_loop</span><span class="p">)</span>

        <span class="c1"># brain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">game_loop</span><span class="p">)</span>

        <span class="c1"># pre physics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="s2">&quot;pre_physics&quot;</span><span class="p">,</span> <span class="n">game_loop</span><span class="p">)</span>

        <span class="c1"># physics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">game_loop</span><span class="p">)</span>

        <span class="c1"># post physics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="s2">&quot;post_physics&quot;</span><span class="p">,</span> <span class="n">game_loop</span><span class="p">)</span>

        <span class="c1"># player is currently standing on ladder (locked into ladder)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_on_ladder</span><span class="p">(</span><span class="n">dt</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="c1"># jumping/falling</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_in_air</span><span class="p">():</span>
            <span class="k">pass</span>

        <span class="c1"># special capabilities can go here: e.g. hit with sword or shoot arrows</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_actions</span><span class="p">():</span>
            <span class="k">pass</span>

        <span class="c1"># moving in x direction</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">vx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_running</span><span class="p">()</span>

        <span class="c1"># not moving in x direction</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">animation</span> <span class="o">==</span> <span class="s2">&quot;stand&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">animation</span> <span class="o">==</span> <span class="s2">&quot;stand_shield_down&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">standing_around_since</span> <span class="o">+=</span> <span class="n">dt</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">standing_around_since</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># not moving in x-direction, but trying -&gt; push</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]:</span>  <span class="c1"># xor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;push&quot;</span><span class="p">)</span>
            <span class="c1"># out of breath from running?</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;check_out_of_breath&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_out_of_breath</span><span class="p">():</span>
                <span class="k">pass</span>
            <span class="c1"># getting bored?</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_bored_timer</span><span class="p">():</span>
                <span class="k">pass</span>
            <span class="c1"># just stand (if allowed)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_play_stand</span><span class="p">():</span>
                <span class="k">pass</span>

        <span class="c1"># pre animation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="s2">&quot;pre_animation&quot;</span><span class="p">,</span> <span class="n">game_loop</span><span class="p">)</span>

        <span class="c1"># animation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">game_loop</span><span class="p">)</span>

        <span class="c1"># post animation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="s2">&quot;post_animation&quot;</span><span class="p">,</span> <span class="n">game_loop</span><span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="Viking.check_actions"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.check_actions">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">check_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Viking.check_on_ladder"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.check_on_ladder">[docs]</a>    <span class="k">def</span> <span class="nf">check_on_ladder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns True if we are currently locked into a ladder, False otherwise</span>
<span class="sd">        - if we are locked into a ladder also set the current SpriteSheet frame manually (via animation.frame and animation.animation=None)</span>

<span class="sd">        :param float dt: the time passed since the last tick</span>
<span class="sd">        :return: whether we are locked into a ladder or not</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">anim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;animation&quot;</span><span class="p">]</span>

        <span class="c1"># we are not locked into a ladder -&gt; early out</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">on_ladder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if our animation is still set to climb -&gt; play default animation</span>
            <span class="k">if</span> <span class="n">anim</span><span class="o">.</span><span class="n">animation</span> <span class="o">==</span> <span class="s2">&quot;climb&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spritesheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;climb&quot;</span><span class="p">)</span>  <span class="c1"># set to climb (is_manual == True; set frame manually when on ladder)</span>

        <span class="c1"># we are almost at the top (last n pixels) -&gt; put end-of-ladder frame</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">bottom</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">touched_ladder</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">top</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">anim</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame_bend</span>
        <span class="c1"># we are reaching the top -&gt; put one-before-end-of-ladder frame</span>
        <span class="k">elif</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">anim</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame_start_climb</span>
        <span class="c1"># we are in middle of ladder -&gt; alternate climbing frames</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">vy</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.12</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ladder_frames</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># set to smallest valid</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ladder_frames</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.001</span>  <span class="c1"># set to largest valid</span>
            <span class="n">anim</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frames</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame</span><span class="p">)]</span>  <span class="c1"># floor to whole frame number</span>

        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="c1"># function is called when sprite lands on floor</span>
<div class="viewcode-block" id="Viking.land"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.land">[docs]</a>    <span class="k">def</span> <span class="nf">land</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="c1"># if impact was big -&gt; bump head/beDizzy</span>
        <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">impact</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">unhealthy_fall_speed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;be_dizzy&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

    <span class="c1"># quicksand or water</span>
<div class="viewcode-block" id="Viking.hit_liquid_ground"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.hit_liquid_ground">[docs]</a>    <span class="k">def</span> <span class="nf">hit_liquid_ground</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">what</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;sink_in_&quot;</span> <span class="o">+</span> <span class="n">what</span><span class="p">)</span></div>

    <span class="c1"># hit a flying particle (shot, arrow, etc..)</span>
<div class="viewcode-block" id="Viking.hit_particle"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.hit_particle">[docs]</a>    <span class="k">def</span> <span class="nf">hit_particle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">unlock_ladder</span><span class="p">()</span>  <span class="c1"># if we are on a ladder -&gt; remove us from it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;get_hurt&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

    <span class="c1"># called when this object gets squeezed from top by a heavy object</span>
<div class="viewcode-block" id="Viking.get_squeezed"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.get_squeezed">[docs]</a>    <span class="k">def</span> <span class="nf">get_squeezed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">squeezer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;get_squeezed&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>
        <span class="c1"># update collision points (top point should be 1px lower than bottom point of squeezer)</span>
        <span class="c1"># TODO: don&#39;t have p.points in spygame ??</span>
        <span class="c1"># dy = (squeezer.rect.y + squeezer.rect.centery) - (self.y + p.points[0][1]) + 1</span>
        <span class="c1"># Q._changePoints(this, 0, dy)</span>

    <span class="c1"># die function (take this Viking out of the game)</span>
<div class="viewcode-block" id="Viking.die"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.die">[docs]</a>    <span class="k">def</span> <span class="nf">die</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span></div>

    <span class="c1"># player is running (called if x-speed != 0)</span>
<div class="viewcode-block" id="Viking.check_running"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.check_running">[docs]</a>    <span class="k">def</span> <span class="nf">check_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]:</span>  <span class="c1"># xor</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">at_wall</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;push&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">)</span></div>

    <span class="c1"># check whether we are in the air</span>
<div class="viewcode-block" id="Viking.check_in_air"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.check_in_air">[docs]</a>    <span class="k">def</span> <span class="nf">check_in_air</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># we are sinking in water/quicksand</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">animation</span> <span class="o">==</span> <span class="s2">&quot;sink_in_quicksand&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">animation</span> <span class="o">==</span> <span class="s2">&quot;sink_in_water&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># falling too fast</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">vy</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">unhealthy_fall_speed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;fall&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># TODO: use something like docking_state to determine whether we are falling or not</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">vy</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># elif not self.docking_state[0]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;jump&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="c1"># check, whether player is getting bored (to play bored sequence)</span>
<div class="viewcode-block" id="Viking.check_bored_timer"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.check_bored_timer">[docs]</a>    <span class="k">def</span> <span class="nf">check_bored_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standing_around_since</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_bored_seq</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">standing_around_since</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_bored_seq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;be_bored1&quot;</span><span class="p">,</span> <span class="s2">&quot;be_bored2&quot;</span><span class="p">]))</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="c1"># check, whether it&#39;s ok to play &#39;stand&#39; animation</span>
<div class="viewcode-block" id="Viking.allow_play_stand"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Viking.allow_play_stand">[docs]</a>    <span class="k">def</span> <span class="nf">allow_play_stand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">anim_setup</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spritesheet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">animation</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">anim_setup</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">anim_setup</span><span class="p">[</span><span class="s2">&quot;flags&quot;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;block_stand&quot;</span><span class="p">)):</span>
            <span class="c1"># TODO: fix this depedency on knowing that some children will be defining `which_stand` method</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">which_stand</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;which_stand&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;stand&quot;</span><span class="p">)</span></div></div>


<span class="c1"># define player: Baleog the Fierce</span>
<div class="viewcode-block" id="Baleog"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Baleog">[docs]</a><span class="k">class</span> <span class="nc">Baleog</span><span class="p">(</span><span class="n">Viking</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">spyg</span><span class="o">.</span><span class="n">SpriteSheet</span><span class="p">(</span><span class="s2">&quot;data/baleog.tsx&quot;</span><span class="p">),</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span>          <span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span>  <span class="c1"># the default animation to play</span>
            <span class="s2">&quot;stand&quot;</span>            <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;block_stand&quot;</span><span class="p">),</span> <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s2">&quot;be_bored1&quot;</span>        <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">},</span>
            <span class="s2">&quot;be_bored2&quot;</span>        <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">},</span>
            <span class="s2">&quot;climb&quot;</span>            <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;manual&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;run&quot;</span>              <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span><span class="p">},</span>
            <span class="s2">&quot;push&quot;</span>             <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">54</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">57</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">},</span>
            <span class="s2">&quot;jump&quot;</span>             <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">36</span><span class="p">,</span> <span class="mi">37</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">6</span><span class="p">},</span>
            <span class="s2">&quot;fall&quot;</span>             <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span>    <span class="p">:</span> <span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">),</span>
                                  <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;paralyzes_exceptions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">}}},</span>
            <span class="s2">&quot;be_dizzy&quot;</span>         <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">39</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes,block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;get_hurt&quot;</span>         <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">72</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes,block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;get_squeezed&quot;</span>     <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">122</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">125</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;die&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes,block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;sink_in_quicksand&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span>  <span class="p">:</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;die&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span>   <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;sink_in_water&quot;</span>    <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span>  <span class="p">:</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">93</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;die&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span>   <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;burn&quot;</span>             <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">126</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">131</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">133</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;die&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes,block_stand&quot;</span><span class="p">)},</span>
            <span class="c1"># disables control, except for action1 (which is pressed down)</span>
            <span class="s2">&quot;swing_sword1&quot;</span>     <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">)},</span>
            <span class="c1"># disables control, except for action1 (which is pressed down)</span>
            <span class="s2">&quot;swing_sword2&quot;</span>     <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;draw_bow&quot;</span>         <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span>  <span class="p">:</span> <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;hold_bow&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span>   <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">),</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;paralyzes_exceptions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d&quot;</span><span class="p">}}},</span>
            <span class="s2">&quot;hold_bow&quot;</span>         <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">31</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">),</span> <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;paralyzes_exceptions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;d&quot;</span><span class="p">}},</span>
                                  <span class="p">},</span>
            <span class="s2">&quot;release_bow&quot;</span>      <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span>  <span class="p">:</span> <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span>   <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;block_stand,paralyzes&quot;</span><span class="p">)},</span>
        <span class="p">})</span>

        <span class="c1"># add non-standard actions to our Brain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">add_translations</span><span class="p">([</span>
            <span class="p">(</span><span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;swing_sword&quot;</span><span class="p">,</span> <span class="n">spyg</span><span class="o">.</span><span class="n">KeyboardBrainTranslation</span><span class="o">.</span><span class="n">DOWN_ONE_TICK</span> <span class="o">|</span> <span class="n">spyg</span><span class="o">.</span><span class="n">KeyboardBrainTranslation</span><span class="o">.</span><span class="n">BLOCK_REPEAT_UNTIL_ANIM_COMPLETE</span><span class="p">,</span>
             <span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;swing_sword1&quot;</span><span class="p">,</span> <span class="s2">&quot;swing_sword2&quot;</span><span class="p">}),</span>  <span class="c1"># sword</span>
            <span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;draw_bow&quot;</span><span class="p">,</span> <span class="n">spyg</span><span class="o">.</span><span class="n">KeyboardBrainTranslation</span><span class="o">.</span><span class="n">UP_ONE_TICK</span> <span class="o">|</span> <span class="n">spyg</span><span class="o">.</span><span class="n">KeyboardBrainTranslation</span><span class="o">.</span><span class="n">BLOCK_OTHER_CMD_UNTIL_ANIM_COMPLETE</span><span class="p">,</span>
             <span class="s2">&quot;release_bow&quot;</span><span class="p">,</span> <span class="s2">&quot;draw_bow&quot;</span><span class="p">),</span>  <span class="c1"># bow (anim draw_bow has to be complete)</span>
        <span class="p">])</span>

        <span class="c1"># parametrize our physics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;physics&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">can_jump</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Baleog.check_actions"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Baleog.check_actions">[docs]</a>    <span class="k">def</span> <span class="nf">check_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># sword or arrow?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_hit_with_sword</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_shoot_with_arrow</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Baleog.check_hit_with_sword"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Baleog.check_hit_with_sword">[docs]</a>    <span class="k">def</span> <span class="nf">check_hit_with_sword</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: True if player is currently hitting with sword</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;brain&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;swing_sword&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;swing_sword1&quot;</span><span class="p">,</span> <span class="s2">&quot;swing_sword2&quot;</span><span class="p">]))</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">animation</span><span class="p">[:</span><span class="mi">11</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;swing_sword&quot;</span></div>

<div class="viewcode-block" id="Baleog.check_shoot_with_arrow"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Baleog.check_shoot_with_arrow">[docs]</a>    <span class="k">def</span> <span class="nf">check_shoot_with_arrow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: True if player is doing something with arrow right now</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;brain&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;draw_bow&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;getting `draw_bow` command: playing draw_bow</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;draw_bow&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;release_bow&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;getting `release_bow` command: playing release_bow and shooting</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;release_bow&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">add_sprite</span><span class="p">(</span><span class="n">Arrow</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="s2">&quot;arrows&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div></div>


<span class="c1"># define player: Erik the Swift</span>
<div class="viewcode-block" id="Erik"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Erik">[docs]</a><span class="k">class</span> <span class="nc">Erik</span><span class="p">(</span><span class="n">Viking</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">spyg</span><span class="o">.</span><span class="n">SpriteSheet</span><span class="p">(</span><span class="s2">&quot;data/erik.tsx&quot;</span><span class="p">),</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span>          <span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span>  <span class="c1"># the default animation to play</span>
            <span class="s2">&quot;stand&quot;</span>            <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;be_bored1&quot;</span>        <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;be_bored2&quot;</span>        <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">61</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s1">&#39;stand&#39;</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;climb&quot;</span>            <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;manual&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;run&quot;</span>              <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span><span class="p">},</span>
            <span class="s2">&quot;out_of_breath&quot;</span>    <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s1">&#39;stand&#39;</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;push&quot;</span>             <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">54</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">57</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">},</span>
            <span class="s2">&quot;jump_up&quot;</span>          <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
            <span class="s2">&quot;jump_peak&quot;</span>        <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
            <span class="s2">&quot;jump_down&quot;</span>        <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">},</span>
            <span class="s2">&quot;fall&quot;</span>             <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span>    <span class="p">:</span> <span class="p">[</span><span class="mi">81</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">),</span>
                                  <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;paralyzes_exceptions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">}}},</span>
            <span class="s2">&quot;be_dizzy&quot;</span>         <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">36</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s1">&#39;stand&#39;</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes,block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;get_hurt&quot;</span>         <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">72</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s1">&#39;stand&#39;</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes,block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;get_squeezed&quot;</span>     <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">126</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">129</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s1">&#39;die&#39;</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes,block_stand&quot;</span><span class="p">))},</span>
            <span class="s2">&quot;sink_in_quicksand&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span>  <span class="p">:</span> <span class="p">[</span><span class="mi">108</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">109</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s1">&#39;die&#39;</span><span class="p">,</span>
                                  <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span>   <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;sink_in_water&quot;</span>    <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span>  <span class="p">:</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">93</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s1">&#39;die&#39;</span><span class="p">,</span>
                                  <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span>   <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;burn&quot;</span>             <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">117</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">124</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s1">&#39;die&#39;</span><span class="p">,</span>
                                  <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">)},</span>
        <span class="p">})</span>

        <span class="c1"># add non-standard actions to our Brain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">add_translations</span><span class="p">([</span>
            <span class="p">(</span><span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;jump&quot;</span><span class="p">),</span>
            <span class="c1"># (&quot;d&quot;, &quot;cmd_smash_wall&quot;, spyg.KeyboardBrainTranslation.),</span>
            <span class="c1"># TODO: smash walls(&quot;d&quot;, &quot;smash&quot;, ),</span>
        <span class="p">])</span>

        <span class="c1"># edit physics a little</span>
        <span class="n">phys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;physics&quot;</span><span class="p">]</span>
        <span class="n">phys</span><span class="o">.</span><span class="n">run_acceleration</span> <span class="o">=</span> <span class="mi">450</span>
        <span class="n">phys</span><span class="o">.</span><span class="n">can_jump</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">phys</span><span class="o">.</span><span class="n">vx_max</span> <span class="o">=</span> <span class="mi">175</span>
        <span class="n">phys</span><span class="o">.</span><span class="n">stops_abruptly_on_direction_change</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ran_fast</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># flag: if True, play outOfBreath sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vx_out_of_breath</span> <span class="o">=</span> <span class="mi">120</span>  <span class="c1"># speed after which to play outOfBreath sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vx_smash_wall</span> <span class="o">=</span> <span class="mi">150</span>  <span class="c1"># minimum speed at which we can initiate smash sequence with &#39;D&#39;</span>

    <span class="c1"># Erik has no special actions</span>
<div class="viewcode-block" id="Erik.check_actions"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Erik.check_actions">[docs]</a>    <span class="k">def</span> <span class="nf">check_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Erik.check_running"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Erik.check_running">[docs]</a>    <span class="k">def</span> <span class="nf">check_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">phys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;physics&quot;</span><span class="p">]</span>
        <span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;brain&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]:</span>  <span class="c1"># xor</span>
            <span class="k">if</span> <span class="n">phys</span><span class="o">.</span><span class="n">at_wall</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;push&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ran_fast</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phys</span><span class="o">.</span><span class="n">vx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vx_out_of_breath</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ran_fast</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="c1"># check whether we are in the air</span>
<div class="viewcode-block" id="Erik.check_in_air"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Erik.check_in_air">[docs]</a>    <span class="k">def</span> <span class="nf">check_in_air</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">anim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;animation&quot;</span><span class="p">]</span>
        <span class="n">phys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;physics&quot;</span><span class="p">]</span>
        <span class="c1"># we are sinking in water/quicksand</span>
        <span class="k">if</span> <span class="n">anim</span><span class="o">.</span><span class="n">animation</span> <span class="o">==</span> <span class="s2">&quot;sink_in_quicksand&quot;</span> <span class="ow">or</span> <span class="n">anim</span><span class="o">.</span><span class="n">animation</span> <span class="o">==</span> <span class="s2">&quot;sink_in_water&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># falling too fast</span>
        <span class="k">elif</span> <span class="n">phys</span><span class="o">.</span><span class="n">vy</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">unhealthy_fall_speed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;fall&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># Erik jumps</span>
        <span class="k">elif</span> <span class="n">phys</span><span class="o">.</span><span class="n">vy</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phys</span><span class="o">.</span><span class="n">vy</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;jump_peak&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">phys</span><span class="o">.</span><span class="n">vy</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;jump_up&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">phys</span><span class="o">.</span><span class="n">vy</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;jump_down&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="c1"># overwrite bored functionality: Erik blinks eyes more often than he does his other crazy stuff</span>
<div class="viewcode-block" id="Erik.check_bored_timer"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Erik.check_bored_timer">[docs]</a>    <span class="k">def</span> <span class="nf">check_bored_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standing_around_since</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_bored_seq</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">standing_around_since</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_bored_seq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;be_bored1&quot;</span><span class="p">,</span> <span class="s2">&quot;be_bored1&quot;</span><span class="p">]))</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="c1"># check whether we should play the out of breath sequence</span>
<div class="viewcode-block" id="Erik.check_out_of_breath"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Erik.check_out_of_breath">[docs]</a>    <span class="k">def</span> <span class="nf">check_out_of_breath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">anim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;animation&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">anim</span><span class="o">.</span><span class="n">animation</span> <span class="o">==</span> <span class="s2">&quot;run&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ran_fast</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;out_of_breath&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ran_fast</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">False</span></div></div>


<span class="c1"># define player: Olaf the ???</span>
<div class="viewcode-block" id="Olaf"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Olaf">[docs]</a><span class="k">class</span> <span class="nc">Olaf</span><span class="p">(</span><span class="n">Viking</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">spyg</span><span class="o">.</span><span class="n">SpriteSheet</span><span class="p">(</span><span class="s2">&quot;data/olaf.tsx&quot;</span><span class="p">),</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span>             <span class="p">:</span> <span class="s2">&quot;stand_shield_down&quot;</span><span class="p">,</span>  <span class="c1"># the default animation to play</span>
            <span class="s2">&quot;stand_shield_down&quot;</span>   <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
            <span class="s2">&quot;stand_shield_up&quot;</span>     <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
            <span class="s2">&quot;be_bored&quot;</span>            <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">which_stand</span><span class="p">,</span>
                                     <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;climb&quot;</span>               <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;manual&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;run_shield_down&quot;</span>     <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span><span class="p">},</span>
            <span class="s2">&quot;run_shield_up&quot;</span>       <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span><span class="p">},</span>
            <span class="s2">&quot;push&quot;</span>                <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">37</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">},</span>
            <span class="s2">&quot;sail_shield_down&quot;</span>    <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">6</span><span class="p">},</span>
            <span class="s2">&quot;sail_shield_up&quot;</span>      <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">},</span>
            <span class="s2">&quot;sail_shield_up_steer&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">28</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">},</span>
            <span class="s2">&quot;fall&quot;</span>                <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span>    <span class="p">:</span> <span class="p">[</span><span class="mi">54</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">),</span>
                                     <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;paralyzes_exceptions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">}}},</span>
            <span class="s2">&quot;be_dizzy&quot;</span>            <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">29</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">which_stand</span><span class="p">,</span>
                                     <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes,block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;get_hurt&quot;</span>            <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">which_stand</span><span class="p">,</span>
                                     <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes,block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;get_squeezed&quot;</span>        <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">117</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;die&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes,block_stand&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;sink_in_quicksand&quot;</span>   <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span>  <span class="p">:</span> <span class="p">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;die&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                     <span class="s2">&quot;flags&quot;</span>   <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;sink_in_water&quot;</span>       <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span>  <span class="p">:</span> <span class="p">[</span><span class="mi">63</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">67</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;die&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                                     <span class="s2">&quot;flags&quot;</span>   <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;burn&quot;</span>                <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">108</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">115</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;die&quot;</span><span class="p">,</span>
                                     <span class="s2">&quot;flags&quot;</span> <span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">)},</span>
        <span class="p">})</span>

        <span class="c1"># add non-standard actions to our Brain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">add_translations</span><span class="p">([</span>
            <span class="p">(</span><span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="s2">&quot;switch_shield&quot;</span><span class="p">,</span> <span class="n">spyg</span><span class="o">.</span><span class="n">KeyboardBrainTranslation</span><span class="o">.</span><span class="n">DOWN_ONE_TICK</span><span class="p">),</span>  <span class="c1"># shield up/down</span>
            <span class="c1"># TODO: careful: if two keys write to the same command, the second key will always overwrite the first one</span>
            <span class="c1"># (&quot;d&quot;, &quot;switch_shield&quot;, spyg.KeyboardBrainTranslation.DOWN_ONE_TICK),  # shield up/down</span>
        <span class="p">])</span>

        <span class="n">phys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span>
        <span class="n">phys</span><span class="o">.</span><span class="n">run_acceleration</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">phys</span><span class="o">.</span><span class="n">vx_max</span> <span class="o">=</span> <span class="mi">140</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_fall_speed_shield_down</span> <span class="o">=</span> <span class="n">phys</span><span class="o">.</span><span class="n">max_fall_speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_fall_speed_shield_up</span> <span class="o">=</span> <span class="n">phys</span><span class="o">.</span><span class="n">max_fall_speed</span> <span class="o">/</span> <span class="mi">10</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame_bend</span> <span class="o">=</span> <span class="mi">39</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frame_start_climb</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ladder_frames</span> <span class="o">=</span> <span class="p">[</span><span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">45</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_shield_up</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># whether Olaf has his shield currently up or down</span>

        <span class="c1"># sneak shield handling into the parent&#39;s tick function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;pre_physics&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;check_switch_shield&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Olaf.check_switch_shield"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Olaf.check_switch_shield">[docs]</a>    <span class="k">def</span> <span class="nf">check_switch_shield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_loop</span><span class="p">):</span>
        <span class="c1"># we are getting a switch shield command -&gt; first switch the position of our shield</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;switch_shield&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_shield_up</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_shield_up</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># toggle</span>
            <span class="c1"># change our physics properties based on shield state</span>
            <span class="c1"># - one-way-feature to Olaf (things can stand on top of him)</span>
            <span class="c1"># - fall-speed</span>
            <span class="n">phys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shield_up</span><span class="p">:</span>
                <span class="n">phys</span><span class="o">.</span><span class="n">max_fall_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fall_speed_shield_up</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">|=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;dockable,one_way_platform&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">phys</span><span class="o">.</span><span class="n">max_fall_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fall_speed_shield_down</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;dockable,one_way_platform&quot;</span><span class="p">))</span>
                <span class="c1"># undock all our currently docked objects (that are standing on top of us)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">game_obj_cmp_dockable</span><span class="o">.</span><span class="n">undock_all_docked_objects</span><span class="p">()</span></div>

<div class="viewcode-block" id="Olaf.which_stand"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Olaf.which_stand">[docs]</a>    <span class="k">def</span> <span class="nf">which_stand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;stand_shield_up&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shield_up</span> <span class="k">else</span> <span class="s2">&quot;stand_shield_down&quot;</span></div>

    <span class="c1"># Olaf has no special actions</span>
<div class="viewcode-block" id="Olaf.check_actions"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Olaf.check_actions">[docs]</a>    <span class="k">def</span> <span class="nf">check_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="c1"># check whether we are in the air</span>
<div class="viewcode-block" id="Olaf.check_in_air"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Olaf.check_in_air">[docs]</a>    <span class="k">def</span> <span class="nf">check_in_air</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># we are sinking in water/quicksand</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">animation</span> <span class="o">==</span> <span class="s2">&quot;sink_in_quicksand&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">animation</span> <span class="o">==</span> <span class="s2">&quot;sink_in_water&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># falling too fast</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">vy</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">unhealthy_fall_speed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;fall&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># TODO: use something like docking_state to determine whether we are falling or not</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">vy</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># elif not self.docking_state[0]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shield_up</span><span class="p">:</span>
                <span class="c1"># we are steering</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;sail_shield_up_steer&quot;</span><span class="p">)</span>
                <span class="c1"># we are just sailing</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;sail_shield_up&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;sail_shield_down&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Olaf.check_bored_timer"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Olaf.check_bored_timer">[docs]</a>    <span class="k">def</span> <span class="nf">check_bored_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standing_around_since</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_bored_seq</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">standing_around_since</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_bored_seq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;be_bored&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Olaf.check_running"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Olaf.check_running">[docs]</a>    <span class="k">def</span> <span class="nf">check_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">phys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;physics&quot;</span><span class="p">]</span>
        <span class="n">brain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;brain&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]:</span>  <span class="c1"># xor</span>
            <span class="k">if</span> <span class="n">phys</span><span class="o">.</span><span class="n">at_wall</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;push&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;run_shield_up&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shield_up</span> <span class="k">else</span> <span class="s2">&quot;run_shield_down&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="VikingLevel"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.VikingLevel">[docs]</a><span class="k">class</span> <span class="nc">VikingLevel</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">Level</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># hook to the Level&#39;s Viking objects (defined in the tmx file&#39;s TiledObjectGroup)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vikings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">State</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">register_event</span><span class="p">(</span><span class="s2">&quot;changed.active_viking&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">register_event</span><span class="p">(</span><span class="s2">&quot;mastered&quot;</span><span class="p">,</span> <span class="s2">&quot;aborted&quot;</span><span class="p">,</span> <span class="s2">&quot;lost&quot;</span><span class="p">,</span> <span class="s2">&quot;viking_reached_exit&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="VikingLevel.play"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.VikingLevel.play">[docs]</a>    <span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># start level (stage the scene; will overwrite the old 0-stage (=main-stage))</span>
        <span class="c1"># - the options-object below will be also stored in [Stage object].options</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Stage</span><span class="o">.</span><span class="n">stage_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;tile_sprite_handler&quot;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">PhysicsComponent</span><span class="o">.</span><span class="n">tile_sprite_handler</span><span class="p">,</span> <span class="n">spyg</span><span class="o">.</span><span class="n">SlopedTileSprite</span><span class="p">),</span>
            <span class="s2">&quot;components&quot;</span>         <span class="p">:</span> <span class="p">[</span><span class="n">spyg</span><span class="o">.</span><span class="n">Viewport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">)]</span>
        <span class="p">})</span>

        <span class="c1"># find all Vikings in the Stage and store them for us</span>
        <span class="k">for</span> <span class="n">sprite</span> <span class="ow">in</span> <span class="n">stage</span><span class="o">.</span><span class="n">sprites</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sprite</span><span class="p">,</span> <span class="n">Viking</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vikings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sprite</span><span class="p">)</span>

        <span class="c1"># handle characters deaths</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">viking</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vikings</span><span class="p">):</span>
            <span class="n">viking</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;die&quot;</span><span class="p">,</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viking_died</span><span class="p">,</span> <span class="n">viking</span><span class="p">))</span>

        <span class="c1"># manage the characters in this level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;vikings&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vikings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;changed.active_viking&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;active_viking_changed&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;active_viking&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># 0=set to first Viking, True=trigger event</span>
        <span class="c1"># tell the Viewport of the Stage to follow the active Viking</span>
        <span class="n">stage</span><span class="o">.</span><span class="n">follow_object_with_viewport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vikings</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;orig_num_vikings&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vikings</span><span class="p">))</span>

        <span class="c1"># activate level triggers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;viking_reached_exit&quot;</span><span class="p">)</span>

        <span class="c1"># activate Ctrl switch vikings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_inputs</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;key_down.rctrl&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;next_active_viking&quot;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_inputs</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;key_down.lctrl&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;next_active_viking&quot;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># activate stage&#39;s escape menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_inputs</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;key_down.escape&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;escape_menu&quot;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># play a new GameLoop giving it some options</span>
        <span class="n">spyg</span><span class="o">.</span><span class="n">GameLoop</span><span class="o">.</span><span class="n">play_a_loop</span><span class="p">(</span><span class="n">screen_obj</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug_rendering</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="VikingLevel.done"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.VikingLevel.done">[docs]</a>    <span class="k">def</span> <span class="nf">done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spyg</span><span class="o">.</span><span class="n">Stage</span><span class="o">.</span><span class="n">get_stage</span><span class="p">()</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;active_viking&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># switch off keyboard</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard_inputs</span><span class="o">.</span><span class="n">update_keys</span><span class="p">()</span>  <span class="c1"># empty list -&gt; no more keys</span></div>

<div class="viewcode-block" id="VikingLevel.escape_menu"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.VikingLevel.escape_menu">[docs]</a>    <span class="k">def</span> <span class="nf">escape_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

        <span class="c1"># TODO: UI</span>
        <span class="sd">&quot;&quot;&quot;def scene_func(stage):</span>
<span class="sd">            spyg.Stage.get_stage().pause()</span>
<span class="sd">            box = stage.add_sprite(new Q.UI.Container({</span>

<span class="sd">                x: Q.width/2,</span>
<span class="sd">                y: Q.height/2,</span>
<span class="sd">                fill: &quot;rgba(255,255,255,0.75)&quot;</span>
<span class="sd">                }));</span>
<span class="sd">            var label = stage.insert(new Q.UI.Text(</span>
<span class="sd">                { x: 0, y: -10 - 30, w: 100, align: &quot;center&quot;, label: &quot;Give up?&quot;, color: &quot;black&quot;,}</span>
<span class="sd">                ), box);</span>
<span class="sd">            var yes = stage.insert(new Q.UI.Button(</span>
<span class="sd">                { x: 0, y: 0, fill: &quot;#CCCCCC&quot;, label: &quot;Yes&quot;},</span>
<span class="sd">                function() { stage.options.levelObj.trigger(&quot;aborted&quot;, stage.options.levelObj); }</span>
<span class="sd">                ), box);</span>
<span class="sd">            var no = stage.insert(new Q.UI.Button(</span>
<span class="sd">                { x: yes.p.w + 20, y: 0, w: yes.p.w, fill: &quot;#CCCCCC&quot;, label: &quot;No&quot; },</span>
<span class="sd">                function() { Q.clearStage(1); Q.stage(0).unpause(); }</span>
<span class="sd">                ), box);</span>
<span class="sd">            box.fit(20);</span>

<span class="sd">        spyg.Stage.stage_scene(spyg.Scene(scene_func), 1, { &quot;screen_obj&quot;: self })</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

    <span class="c1"># handles a dead character</span>
<div class="viewcode-block" id="VikingLevel.viking_died"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.VikingLevel.viking_died">[docs]</a>    <span class="k">def</span> <span class="nf">viking_died</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dead_viking</span><span class="p">):</span>
        <span class="c1"># remove the guy from the Characters list</span>
        <span class="n">vikings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vikings&quot;</span><span class="p">)</span>
        <span class="n">active</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;active_viking&quot;</span><span class="p">)</span>

        <span class="c1"># remove the guy from vikings list</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">viking</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vikings</span><span class="p">):</span>

            <span class="c1"># found the dead guy</span>
            <span class="k">if</span> <span class="n">viking</span> <span class="ow">is</span> <span class="n">dead_viking</span><span class="p">:</span>
                <span class="n">vikings</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="c1"># no one left for the player to control -&gt; game over, man!</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vikings</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># TODO: UI alert(&quot;You lost!\nClearing stage 0.&quot;);</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="s2">&quot;lost&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

                <span class="c1"># if viking was the active one, make next viking in list the new active one</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">active</span><span class="p">:</span>
                    <span class="c1"># was the last one in list, make first one the active guy</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">vikings</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dec</span><span class="p">(</span><span class="s2">&quot;active_viking&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># decrement by one: will now point to last viking in list ...</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">next_active_viking</span><span class="p">()</span>  <span class="c1"># ... will move pointer to first element in list</span>

                    <span class="c1"># leave active pointer where it is and call _activeCharacterChanged</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">active_viking_changed</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="k">break</span></div>

    <span class="c1"># handles a character reaching the exit</span>
<div class="viewcode-block" id="VikingLevel.viking_reached_exit"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.VikingLevel.viking_reached_exit">[docs]</a>    <span class="k">def</span> <span class="nf">viking_reached_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viking</span><span class="p">):</span>
        <span class="n">characters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vikings&quot;</span><span class="p">)</span>
        <span class="n">num_reached_exit</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">still_alive</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">characters</span><span class="p">)</span>
        <span class="c1"># check all characters&#39; status (dead OR reached exit)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">still_alive</span><span class="p">):</span>
            <span class="c1"># at exit</span>
            <span class="k">if</span> <span class="n">characters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s2">&quot;physics&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">at_exit</span><span class="p">:</span>
                <span class="n">num_reached_exit</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># all original characters reached the exit (level won)</span>
        <span class="k">if</span> <span class="n">num_reached_exit</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;orig_num_vikings&quot;</span><span class="p">):</span>
            <span class="c1"># TODO UI alert(&quot;Great! You made it!&quot;);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="s2">&quot;mastered&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># everyone is at exit, but some guys died</span>
        <span class="k">elif</span> <span class="n">num_reached_exit</span> <span class="o">==</span> <span class="n">still_alive</span><span class="p">:</span>
            <span class="c1"># TODO: UI alert(&quot;Sorry, all of you have to reach the exit.&quot;);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="p">()</span>
            <span class="c1"># TODO: 2) fix black screen mess when level lost or aborted</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_event</span><span class="p">(</span><span class="s2">&quot;lost&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

    <span class="c1"># returns the next active character (-1 if none) and moves the activeCharacter pointer to that next guy</span>
<div class="viewcode-block" id="VikingLevel.next_active_viking"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.VikingLevel.next_active_viking">[docs]</a>    <span class="k">def</span> <span class="nf">next_active_viking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;active_viking&quot;</span><span class="p">)</span>
        <span class="c1"># TODO if typeof slot == &#39;undefined&#39;:</span>
        <span class="c1">#    return -1</span>
        <span class="n">vikings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vikings&quot;</span><span class="p">)</span>
        <span class="n">next_</span> <span class="o">=</span> <span class="p">((</span><span class="n">slot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">vikings</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;active_viking&quot;</span><span class="p">,</span> <span class="n">next_</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">next_</span></div>

    <span class="c1"># reacts to a change in the active character to some new slot</span>
    <span class="c1"># - changes the viewport follow to the new guy</span>
<div class="viewcode-block" id="VikingLevel.active_viking_changed"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.VikingLevel.active_viking_changed">[docs]</a>    <span class="k">def</span> <span class="nf">active_viking_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_viking_idx</span><span class="p">):</span>
        <span class="n">vikings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;vikings&quot;</span><span class="p">)</span>
        <span class="c1"># someone is active</span>
        <span class="k">if</span> <span class="n">new_viking_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vikings</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">new_viking_idx</span><span class="p">:</span>
                    <span class="n">vikings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">deactivate</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vikings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span>

            <span class="c1"># make the Stage follow the new Viking</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Stage</span><span class="o">.</span><span class="n">get_stage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># default stage</span>
            <span class="n">stage</span><span class="o">.</span><span class="n">follow_object_with_viewport</span><span class="p">(</span><span class="n">vikings</span><span class="p">[</span><span class="n">new_viking_idx</span><span class="p">],</span> <span class="n">max_speed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1"># make the new Viking blink for a while</span>
            <span class="n">vikings</span><span class="p">[</span><span class="n">new_viking_idx</span><span class="p">]</span><span class="o">.</span><span class="n">blink_animation</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>  <span class="c1"># 15/s for 1.5s</span>
        <span class="c1"># no one is active anymore -&gt; switch &#39;em all off</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">viking</span> <span class="ow">in</span> <span class="n">vikings</span><span class="p">:</span>
                <span class="n">viking</span><span class="o">.</span><span class="n">deactivate</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Shot"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Shot">[docs]</a><span class="k">class</span> <span class="nc">Shot</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">AnimatedSprite</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    a shot (like the one a scorpion shoots)</span>
<span class="sd">    - can be extended to do more complicated stuff</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">,</span> <span class="n">spritesheet</span><span class="p">,</span> <span class="n">animation_setup</span><span class="p">,</span> <span class="n">shooter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        a generic Shot object being spawned into the game usually by a Shooter object</span>
<span class="sd">        :param int offset_x: the x-offset with respect to the Shooter&#39;s x position</span>
<span class="sd">        :param int offset_y: the y-offset with respect to the Shooter&#39;s y position</span>
<span class="sd">        :param spyg.SpriteSheet spritesheet:</span>
<span class="sd">        :param dict animation_setup: the animation_setup dictionary that will be sent to the Animation component</span>
<span class="sd">        :param spyg.Sprite shooter: the Shooter&#39;s (Sprite) object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_x</span> <span class="o">=</span> <span class="n">offset_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_y</span> <span class="o">=</span> <span class="n">offset_y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shooter</span> <span class="o">=</span> <span class="n">shooter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shooter</span><span class="o">.</span><span class="n">flip</span>  <span class="c1"># flip particle depending on shooter&#39;s flip</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shooter</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flip</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">shooter</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_y</span><span class="p">,</span>
                         <span class="n">spritesheet</span><span class="p">,</span> <span class="n">animation_setup</span><span class="p">)</span>

        <span class="c1"># some simple physics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ay</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vx</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">damage</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hit_something</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;particle&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mask</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;default,friendly&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vx</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">vx</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flip</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">vx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;collision&quot;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;collision_done&quot;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># simple tick function with ax and ay, speed- and pos-recalc, and collision detection</span>
<div class="viewcode-block" id="Shot.tick"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Shot.tick">[docs]</a>    <span class="k">def</span> <span class="nf">tick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_loop</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">game_loop</span><span class="o">.</span><span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vx</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flip</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vx</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vy</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ay</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vy</span> <span class="o">*</span> <span class="n">dt</span>

        <span class="c1"># tick the animation component</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">game_loop</span><span class="p">)</span></div>

    <span class="c1"># we hit something</span>
<div class="viewcode-block" id="Shot.collision"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Shot.collision">[docs]</a>    <span class="k">def</span> <span class="nf">collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="c1"># we hit our own shooter -&gt; ignore</span>
        <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">sprite2</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">shooter</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hit_something</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># stop abruptly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ay</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># play &#39;hit&#39; if exists, otherwise just destroy object</span>
        <span class="k">if</span> <span class="s2">&quot;hit&quot;</span> <span class="ow">in</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">animation_settings</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">spritesheet</span><span class="o">.</span><span class="n">name</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;hit&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collision_done</span><span class="p">()</span></div>

    <span class="c1"># we are done hitting something</span>
<div class="viewcode-block" id="Shot.collision_done"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Shot.collision_done">[docs]</a>    <span class="k">def</span> <span class="nf">collision_done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Arrow"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Arrow">[docs]</a><span class="k">class</span> <span class="nc">Arrow</span><span class="p">(</span><span class="n">Shot</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    arrow class</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shooter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param Sprite shooter: the shooter that shoots this Arrow object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">spyg</span><span class="o">.</span><span class="n">SpriteSheet</span><span class="p">(</span><span class="s2">&quot;data/arrow.tsx&quot;</span><span class="p">),</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;fly&quot;</span><span class="p">,</span>  <span class="c1"># the default animation to play</span>
            <span class="s2">&quot;fly&quot;</span>    <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">10</span><span class="p">},</span>
        <span class="p">},</span> <span class="n">shooter</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;arrow,particle&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mask</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;default,enemy,friendly,coconut&quot;</span><span class="p">)</span>

        <span class="c1"># simple physics, no extra component needed for that</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ay</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vx</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vy</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span></div>


<div class="viewcode-block" id="Fireball"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Fireball">[docs]</a><span class="k">class</span> <span class="nc">Fireball</span><span class="p">(</span><span class="n">Shot</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    fireball class</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shooter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param Sprite shooter: the shooter that shoots this FireBall object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">spyg</span><span class="o">.</span><span class="n">SpriteSheet</span><span class="p">(</span><span class="s2">&quot;data/fireball.tsx&quot;</span><span class="p">),</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;fly&quot;</span><span class="p">,</span>  <span class="c1"># the default animation to play</span>
            <span class="s2">&quot;fly&quot;</span>    <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">5</span><span class="p">},</span>
            <span class="s2">&quot;hit&quot;</span>    <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;collision_done&quot;</span><span class="p">}</span>
        <span class="p">},</span> <span class="n">shooter</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vx</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;particle,fireball&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mask</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;default,friendly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">damage</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># a fireball causes more damage</span></div>


<div class="viewcode-block" id="FireSpitter"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.FireSpitter">[docs]</a><span class="k">class</span> <span class="nc">FireSpitter</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    a FireSpitter can spit fireballs that kill the Vikings</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">):</span>
        <span class="c1"># fixed static image (a tile inside the png image)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">image_file</span><span class="o">=</span><span class="s2">&quot;images/egpt.png&quot;</span><span class="p">,</span> <span class="n">image_section</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span>  <span class="c1"># shooting frequency (in 1/s)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_shot_fired</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># keep track of last shot fired</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mask</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="FireSpitter.tick"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.FireSpitter.tick">[docs]</a>    <span class="k">def</span> <span class="nf">tick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_loop</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">game_loop</span><span class="o">.</span><span class="n">dt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_shot_fired</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="c1"># time&#39;s up -&gt; fire shot</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_shot_fired</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_shot_fired</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fire</span><span class="p">()</span></div>

<div class="viewcode-block" id="FireSpitter.fire"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.FireSpitter.fire">[docs]</a>    <span class="k">def</span> <span class="nf">fire</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stage</span><span class="o">.</span><span class="n">add_sprite</span><span class="p">(</span><span class="n">Fireball</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="s2">&quot;fireballs&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Scorpion"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Scorpion">[docs]</a><span class="k">class</span> <span class="nc">Scorpion</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">AnimatedSprite</span><span class="p">):</span>
    <span class="c1"># recyclable SpriteSheets</span>
    <span class="n">sprite_sheet</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="c1"># init our recyclable SpriteSheets</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sprite_sheet</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sprite_sheet</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">SpriteSheet</span><span class="p">(</span><span class="s2">&quot;data/enemies.tsx&quot;</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sprite_sheet</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span>  <span class="s2">&quot;stand&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stand&quot;</span><span class="p">:</span>    <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">72</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s2">&quot;get_hurt&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">72</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">),</span> <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>
            <span class="s2">&quot;run&quot;</span><span class="p">:</span>      <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">72</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">76</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="s2">&quot;shoot&quot;</span><span class="p">:</span>    <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">78</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">84</span><span class="p">],</span> <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">),</span> <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="p">},</span> <span class="n">anim_settings_name</span><span class="o">=</span><span class="s2">&quot;scorpion&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;enemy&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mask</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;default,friendly,particle&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_mad</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># when mad, moves with twice the speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_mad_since</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># add our Components</span>
        <span class="n">ai_brain</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">AIBrain</span><span class="p">(</span><span class="s2">&quot;brain&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">ai_brain</span><span class="p">)</span>  <span class="c1"># type: spyg.AIBrain</span>

        <span class="n">phys</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">PlatformerPhysics</span><span class="p">(</span><span class="s2">&quot;physics&quot;</span><span class="p">)</span>
        <span class="n">phys</span><span class="o">.</span><span class="n">run_acceleration</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># don&#39;t accelerate (always move at max-speed)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">phys</span><span class="p">)</span>  <span class="c1"># type: spyg.PlatformerPhysics</span>

        <span class="c1"># register and setup our events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;hit.particle&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;hit_particle&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Scorpion.tick"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Scorpion.tick">[docs]</a>    <span class="k">def</span> <span class="nf">tick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_loop</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">game_loop</span><span class="o">.</span><span class="n">dt</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">game_loop</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mad_since</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_mad_since</span> <span class="o">+=</span> <span class="n">dt</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mad_since</span> <span class="o">&gt;</span> <span class="mf">5.0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calm_down</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">game_loop</span><span class="p">)</span>

        <span class="c1"># shooting</span>
        <span class="c1"># if self.cmp_brain.commands[&quot;fire&quot;]:</span>
        <span class="c1">#    self.play_animation(&quot;shoot&quot;)</span>
        <span class="c1">#    shot = Shot(0, 0, spritesheet=self.sprite_sheet, shooter=self, animation_setup={</span>
        <span class="c1"># &quot;default&quot;: &quot;fly&quot;,</span>
        <span class="c1"># &quot;fly&quot;:     {&quot;frames&quot;: [85], &quot;loop}})</span>
        <span class="c1">#    shot.vx = 80</span>
        <span class="c1">#    shot.vy = -100</span>
        <span class="c1">#    shot.ay = 140</span>
        <span class="c1">#    self.stage.add_sprite(shot)</span>
        <span class="c1"># moving in x direction</span>
        <span class="c1"># el</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">vx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_running</span><span class="p">()</span>
        <span class="c1"># not moving in x direction</span>
        <span class="c1"># -&gt; play stand with low priority</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;stand&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">game_loop</span><span class="p">)</span></div>

    <span class="c1"># is running (called if x-speed != 0)</span>
<div class="viewcode-block" id="Scorpion.check_running"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Scorpion.check_running">[docs]</a>    <span class="k">def</span> <span class="nf">check_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">animation</span> <span class="o">!=</span> <span class="s2">&quot;run&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">)</span></div>

    <span class="c1"># hit a flying particle (shot, arrow, etc..)</span>
<div class="viewcode-block" id="Scorpion.hit_particle"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Scorpion.hit_particle">[docs]</a>    <span class="k">def</span> <span class="nf">hit_particle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="c1"># sliding away from particle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">vx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">col</span><span class="o">.</span><span class="n">normal_x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;get_hurt&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_mad</span><span class="p">()</span></div>

<div class="viewcode-block" id="Scorpion.get_mad"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Scorpion.get_mad">[docs]</a>    <span class="k">def</span> <span class="nf">get_mad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mad</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_mad_since</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">vx_max</span> <span class="o">*=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_mad</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Scorpion.calm_down"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Scorpion.calm_down">[docs]</a>    <span class="k">def</span> <span class="nf">calm_down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mad</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">vx_max</span> <span class="o">/=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_mad</span> <span class="o">=</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="Dinosaur"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Dinosaur">[docs]</a><span class="k">class</span> <span class="nc">Dinosaur</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">AnimatedSprite</span><span class="p">):</span>
    <span class="n">sprite_sheet</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sprite_sheet</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sprite_sheet</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">SpriteSheet</span><span class="p">(</span><span class="s2">&quot;data/enemies.tsx&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s2">&quot;blue&quot;</span> <span class="k">else</span> <span class="mi">24</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s2">&quot;red&quot;</span> <span class="k">else</span> <span class="mi">12</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sprite_sheet</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span>  <span class="s2">&quot;stand&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stand&quot;</span><span class="p">:</span>    <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span><span class="p">],</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s2">&quot;get_hurt&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span><span class="p">,</span> <span class="mi">10</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">)},</span>
            <span class="s2">&quot;run&quot;</span><span class="p">:</span>      <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span><span class="p">,</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span><span class="p">,</span> <span class="mi">3</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">},</span>
            <span class="s2">&quot;bite&quot;</span><span class="p">:</span>     <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span><span class="p">,</span> <span class="mi">5</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span><span class="p">,</span> <span class="mi">6</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span><span class="p">,</span> <span class="mi">7</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span><span class="p">,</span> <span class="mi">8</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_offset</span><span class="p">],</span>
                         <span class="s2">&quot;next&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">},</span>
            <span class="s2">&quot;die&quot;</span><span class="p">:</span>      <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;trigger&quot;</span><span class="p">:</span> <span class="s2">&quot;die&quot;</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Animation</span><span class="o">.</span><span class="n">get_flag</span><span class="p">(</span><span class="s2">&quot;paralyzes&quot;</span><span class="p">)},</span>
        <span class="p">},</span> <span class="n">width_height</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span> <span class="n">anim_settings_name</span><span class="o">=</span><span class="s2">&quot;dinosaur&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;enemy&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mask</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;default,friendly,particle&quot;</span><span class="p">)</span>

        <span class="c1"># TODO: give all Sprites a `touching` list of Sprite&#39;s of type</span>

        <span class="n">ai_brain</span> <span class="o">=</span> <span class="n">DinosaurBrain</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">ai_brain</span><span class="p">)</span>  <span class="c1"># type: spyg.AIBrain</span>

        <span class="n">phys</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">PlatformerPhysics</span><span class="p">(</span><span class="s2">&quot;physics&quot;</span><span class="p">)</span>
        <span class="n">phys</span><span class="o">.</span><span class="n">vx_max</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">phys</span><span class="o">.</span><span class="n">run_acceleration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">phys</span><span class="p">)</span>  <span class="c1"># type: spyg.PlatformerPhysics</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">life_energy</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># 0 -&gt; die</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_mad_since</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># when mad, moves with twice the speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;hit.particle&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;hit_particle&quot;</span><span class="p">)</span>
        <span class="c1"># self.on_event(&quot;bump.left&quot;, self, &quot;attack&quot;)</span>
        <span class="c1"># self.on_event(&quot;bump.right&quot;, self, &quot;attack&quot;)</span>

<div class="viewcode-block" id="Dinosaur.tick"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Dinosaur.tick">[docs]</a>    <span class="k">def</span> <span class="nf">tick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_loop</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">game_loop</span><span class="o">.</span><span class="n">dt</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">game_loop</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">game_loop</span><span class="p">)</span>

        <span class="c1"># attacking?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;attack&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;bite&quot;</span><span class="p">)</span>
        <span class="c1"># moving in x direction</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_physics</span><span class="o">.</span><span class="n">vx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_running</span><span class="p">()</span>
        <span class="c1"># not moving in x direction -&gt; play stand</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;stand&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="n">game_loop</span><span class="p">)</span></div>

    <span class="c1"># is running (called if x-speed != 0)</span>
<div class="viewcode-block" id="Dinosaur.check_running"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Dinosaur.check_running">[docs]</a>    <span class="k">def</span> <span class="nf">check_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_brain</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmp_animation</span><span class="o">.</span><span class="n">animation</span> <span class="o">!=</span> <span class="s2">&quot;run&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dinosaur.hit_particle"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Dinosaur.hit_particle">[docs]</a>    <span class="k">def</span> <span class="nf">hit_particle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when hit by a particle type object.</span>

<span class="sd">        :param Collision col: the Collision object describing the collision</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arrow</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">sprite2</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arrow</span><span class="p">,</span> <span class="n">Arrow</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">arrow</span><span class="o">.</span><span class="n">hit_something</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">life_energy</span> <span class="o">-=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">damage</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">life_energy</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">()</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;get_hurt&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dinosaur.die"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Dinosaur.die">[docs]</a>    <span class="k">def</span> <span class="nf">die</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">play_animation</span><span class="p">(</span><span class="s2">&quot;die&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="DinosaurBrain"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.DinosaurBrain">[docs]</a><span class="k">class</span> <span class="nc">DinosaurBrain</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">AIBrain</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s2">&quot;brain&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;attack&quot;</span><span class="p">])</span>

<div class="viewcode-block" id="DinosaurBrain.bumped"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.DinosaurBrain.bumped">[docs]</a>    <span class="k">def</span> <span class="nf">bumped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="n">other_sprite</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">sprite2</span>
        <span class="c1"># a player sprite</span>
        <span class="k">if</span> <span class="n">other_sprite</span><span class="o">.</span><span class="n">type</span> <span class="o">&amp;</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;friendly&quot;</span><span class="p">):</span>
            <span class="c1"># start attacking</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s2">&quot;attack&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># a wall?</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_direction</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="Coconut"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Coconut">[docs]</a><span class="k">class</span> <span class="nc">Coconut</span><span class="p">(</span><span class="n">spyg</span><span class="o">.</span><span class="n">AnimatedSprite</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">spyg</span><span class="o">.</span><span class="n">SpriteSheet</span><span class="p">(</span><span class="s2">&quot;data/coconut.tsx&quot;</span><span class="p">),</span> <span class="p">{</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;stand&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stand&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]},</span>
            <span class="s2">&quot;roll&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;frames&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;coconut&quot;</span><span class="p">)</span>
        <span class="c1"># only react to arrows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision_mask</span> <span class="o">=</span> <span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;arrow&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_location</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_damaged</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># True if has been hit already once by an arrow</span>
        <span class="c1"># simple state flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_falling</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hit_ground</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reached_end_position</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># simple physics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># register and subscribe to collision events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;collision&quot;</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="Coconut.tick"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Coconut.tick">[docs]</a>    <span class="k">def</span> <span class="nf">tick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_loop</span><span class="p">):</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">game_loop</span><span class="o">.</span><span class="n">dt</span>

        <span class="c1"># we have already reached the end position: do nothing</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reached_end_position</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># we already hit the ground</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_ground</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># we are still falling</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_falling</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vy</span> <span class="o">+=</span> <span class="mi">10</span>  <span class="c1"># accelerate</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vy</span></div>

<div class="viewcode-block" id="Coconut.collision"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Coconut.collision">[docs]</a>    <span class="k">def</span> <span class="nf">collision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        our collision resolver (triggered by the Stage)</span>
<span class="sd">        :param Collision col: the Collision object describing the collision</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">other_obj</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">sprite2</span>
        <span class="c1"># got hit by arrow</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_obj</span><span class="p">,</span> <span class="n">Arrow</span><span class="p">):</span>
            <span class="c1"># we are already damaged -&gt; fall</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_damaged</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_falling</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_damaged</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shake</span><span class="p">()</span>

        <span class="c1"># hit the ground -&gt; stop falling and start rolling to side</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_obj</span><span class="p">,</span> <span class="n">spyg</span><span class="o">.</span><span class="n">TileSprite</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collision_mask</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">spyg</span><span class="o">.</span><span class="n">Sprite</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span><span class="s2">&quot;arrow&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_falling</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hit_ground</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vy</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>  <span class="c1"># constant side-ways speed</span></div>

<div class="viewcode-block" id="Coconut.shake"><a class="viewcode-back" href="../../../spygame_reference.html#spygame.examples.vikings.Coconut.shake">[docs]</a>    <span class="k">def</span> <span class="nf">shake</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        shakes the coconut for a while back and forth (after being hit by arrow)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shake_time</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># seconds</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">spygame 0.1a8 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../spygame.html" >spygame</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, ducandu GmbH.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.2.
    </div>
  </body>
</html>